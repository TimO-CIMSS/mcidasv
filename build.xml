<?xml version="1.0"?>

<!-- $Id$ -->

<project name="mcidasv" default="info">

	<!-- directory definitions -->
    <property name="basedir" location="."/>
    <property name="distdir" location="${basedir}/dist"/>
    <property name="libdir" location="${basedir}/lib"/>
	<property name="docdir" location="${basedir}/doc"/>
	<property name="javadoc.dir" location="${docdir}/javadoc"/>

    <!-- required library jarfile names -->
    <property name="visad.jar" value="visad.jar"/>
    <property name="idv.jar" value="idv.jar"/>

    <!-- compiler options -->
    <property name="debug.flag" value="true"/>
    <property name="deprecation.flag" value="false"/>
    <property name="source.ver" value="1.5"/>
    <property name="target.ver" value="1.5"/>

    <!-- javadoc options -->
    <property name="javadoc.level" value="private"/>

    <!-- shared classpath -->
    <path id="app.classpath">
        <pathelement location="${libdir}/${visad.jar}"/>
        <pathelement location="${libdir}/${idv.jar}"/>
        <pathelement location="${basedir}"/>
    </path>

    <!-- files to include in application jar -->
    <patternset id="jar.includes">
        <include name="edu/**/*.class"/>
        <include name="edu/**/resources/**/*"/>
        <include name="edu/**/images/**/*"/>
    </patternset>

	<!-- just print out some of the setting for this build file -->
    <target name="info">
    	<echo>
== ANT ======================= 
ant java version: ${ant.java.version}
ant lib dir: ${ant.library.dir}
ant home: ${ant.home}
ant basedir: ${basedir}

== JAVA ======================
java home: ${java.home}
java version: ${java.runtime.version}
javadoc access: ${javadoc.level}
    	
== COMPILER OPTIONS ==========
source: ${source.ver}
target: ${target.ver}
debug(-g): ${debug.flag}
deprecation: ${deprecation.flag}
    		
== PROPTERTIES ===============
libdir: ${libdir}
docdir: ${docdir}
javadoc.dir: ${javadoc.dir}
        </echo>
    </target>


    <!-- perform all operations to build the entire project -->
    <target name="build">
        <!-- compile in place all class files in the base directory -->
        <javac srcdir="${basedir}/edu/"
               source="${source.ver}" 
               target="${target.ver}"
               debug="${debug.flag}"
               deprecation="${deprecation.flag}">
            <classpath refid="app.classpath"/>
        </javac>
    </target>

	<!-- generate the javadoc documentation -->
	<target name="javadoc">
	    <javadoc destdir="${javadoc.dir}" 
	            source="${source.ver}"
	            access="${javadoc.level}"
	            use="true" 
	            notree="false" 
	            nonavbar="false" 
	            noindex="false" 
	            splitindex="true" 
	            author="true" 
	            version="true" 
	            nodeprecatedlist="false" 
	            nodeprecated="false" 
	            sourcepath="${basedir}/edu" 
	            breakiterator="yes"
	            doctitle="McIDAS-V Documentation">
	
	    	<packageset dir="${basedir}" defaultexcludes="yes">
	    		<include name="edu/**"/>
	    	</packageset>
	    	
	      	<link href="http://java.sun.com/products/java-media/3D/forDevelopers/J3D_1_3_API/j3dapi" />
	      	<link href="http://java.sun.com/j2se/1.5/docs/api" />
	      	<link href="http://www.unidata.ucar.edu/software/idv/docs/javadoc"/>
	
	      	<classpath refid="app.classpath"/>
	    </javadoc>
	</target>
	
	<!-- jar the binaries -->
    <target name="jar" depends="clean, build">
        <mkdir dir="${distdir}"/>
        <jar destfile="${distdir}/mcidasv.jar">
            <fileset dir="${basedir}">
                <patternset refid="jar.includes"/>
            </fileset>
            <manifest>
                <attribute name="Build-By" value="${user.name}"/>
            </manifest>
        </jar>
    </target>
	
	<!-- delete everything we created -->
	<target name="clean">
		<delete dir="${distdir}" failonerror="false"/>
		<delete dir="${javadoc.dir}" failonerror="false"/>
		<delete failonerror="false">
			<fileset dir="${basedir}/edu" includes="**/*.class"/>
		</delete>
	</target>
    
</project>